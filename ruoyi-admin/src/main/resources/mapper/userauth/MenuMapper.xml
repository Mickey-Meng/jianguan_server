<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.ruoyi.web.controller.jianguan.other.zlsk.strestservice.userauth.mapper.MenuMapper">

    <select id="select" resultType="Map" parameterType="Map">
     SELECT t1.*,t2.sid,t3.sysName  FROM
	(select * from ss_c_menu where STSTATE = 1) t1
	LEFT JOIN ( SELECT mid, GROUP_CONCAT( sid ) AS sid FROM ss_c_subsystem_menu GROUP BY mid) t2 ON t1.ID = t2.mid
	left join  subsystem t3 on t2.sid = t3.id
	 where  1=1
        <if test="id != null and id != ''">and t1.ID = #{id}</if>
        <if test="name != null and name != ''">and t1.NAME = #{name}</if>
        <if test="menucode != null and menucode != ''">and t1.MENUCODE = #{menucode}</if>
        <if test="parentid != null and parentid != ''">and t1.PARENTID = #{parentid}</if>
        <if test="visible != null and visible != ''">and t1.VISIBLE = #{visible}</if>
        ORDER BY t1.STORDER;
    </select>

    <select id="selectMenuBySys" resultType="Map" parameterType="Map">
       select t2.* from  (select  t2.* from   subsystem t1,ss_c_subsystem_menu t2 where t1.id = t2.sid
        <if test="sysName != null and sysName != ''">and (t1.sysName = #{sysName}</if>
        <if test="sysCode != null and sysCode != ''">or t1.sysCode = #{sysCode})</if>
        ) t1 LEFT join (select * from ss_c_menu where STSTATE = 1) t2 on t1.mid = t2.ID
        where 1=1
        <if test="id != null and id != ''">and t2.ID = #{id}</if>
        <if test="name != null and name != ''">and t2.NAME = #{name}</if>
        <if test="menucode != null and menucode != ''">and t2.MENUCODE = #{menucode}</if>
        <if test="parentid != null and parentid != ''">and t2.PARENTID = #{parentid}</if>
        <if test="visible != null and visible != ''">and t2.VISIBLE = #{visible}</if>
        ORDER BY t2.STORDER;
    </select>

    <select id="selectMenuByUserauth" resultType="Map" parameterType="Map">
        SELECT
            t1.*,
            t2.sid,
            t3.sysName
        FROM
            ( SELECT * FROM ss_c_menu WHERE STSTATE = 1 ) t1
            LEFT JOIN ( SELECT mid, GROUP_CONCAT( sid ) AS sid FROM ss_c_subsystem_menu GROUP BY mid ) t2 ON t1.ID = t2.mid
            LEFT JOIN ( SELECT * FROM ss_f_userauth ) t4 on t4.rid = t1.id
            LEFT JOIN subsystem t3 ON t2.sid = t3.id
        WHERE
            <if test="uid != null and uid != ''">t4.UID = #{uid}</if>
            <if test="rtype != null and rtype != ''">and t4.RTYPE = #{rtype}</if>
            <if test="utype != null and utype != ''">and t4.UTYPE = #{utype}</if>
        ORDER BY
            t1.STORDER;
    </select>

    <select id="selectByUserauth" resultType="Map" parameterType="Map">
        select m.* from ss_f_userauth u
        left join ss_c_menu m on m.ID = u.RID
        where u.STSTATE = 1 and m.STSTATE = 1
        <if test="uid != null and uid != ''">and u.UID = #{uid}</if>
        <if test="rid != null and rid != ''">and u.RID = #{rid}</if>
        <if test="rtype != null and rtype != ''">and u.RTYPE = #{rtype}</if>
        <if test="utype != null and utype != ''">and u.UTYPE = #{utype}</if>
    </select>

    <insert id="insert" parameterType="com.ruoyi.web.controller.jianguan.other.zlsk.strestservice.userauth.model.Menu" useGeneratedKeys="true" keyProperty="id" >
        insert into ss_c_menu
        <trim prefix="(" suffix=")" suffixOverrides=",">
            <if test="id != null">
                ID,
            </if>
            <if test="name != null">
                NAME,
            </if>
            <if test="parentid != null">
                PARENTID,
            </if>
            <if test="url != null">
                URL,
            </if>
            <if test="config != null">
                CONFIG,
            </if>
            <if test="style != null">
                STYLE,
            </if>
            <if test="icon != null">
                ICON,
            </if>
            <if test="icon2 != null">
                ICON2,
            </if>
            <if test="menuconfig != null">
                MENUCONFIG,
            </if>
            <if test="visible != null">
                VISIBLE,
            </if>
            <if test="sttime != null">
                STTIME,
            </if>
            <if test="ststate != null">
                STSTATE,
            </if>
            <if test="storder != null">
                STORDER,
            </if>
            <if test="type != null">
                TYPE,
            </if>
            <if test="region != null">
                REGION,
            </if>
             <if test="menucode != null">
                MENUCODE,
            </if>
        </trim>
        <trim prefix="values (" suffix=")" suffixOverrides=",">
            <if test="id != null">
                #{id,jdbcType=INTEGER},
            </if>
            <if test="name != null">
                #{name,jdbcType=VARCHAR},
            </if>
            <if test="parentid != null">
                #{parentid,jdbcType=INTEGER},
            </if>
            <if test="url != null">
                #{url,jdbcType=VARCHAR},
            </if>
            <if test="config != null">
                #{config,jdbcType=VARCHAR},
            </if>
            <if test="style != null">
                #{style,jdbcType=VARCHAR},
            </if>
            <if test="icon != null">
                #{icon,jdbcType=VARCHAR},
            </if>
            <if test="icon2 != null">
                #{icon2,jdbcType=VARCHAR},
            </if>
            <if test="menuconfig != null">
                #{menuconfig,jdbcType=VARCHAR},
            </if>
            <if test="visible != null">
                #{visible,jdbcType=VARCHAR},
            </if>
            <if test="sttime != null">
                #{sttime,jdbcType=TIMESTAMP},
            </if>
            <if test="ststate != null">
                #{ststate,jdbcType=INTEGER},
            </if>
            <if test="storder != null">
                #{storder,jdbcType=INTEGER},
            </if>
             <if test="type != null">
                #{type,jdbcType=VARCHAR},
            </if>
             <if test="region != null">
                #{region,jdbcType=VARCHAR},
            </if>
            <if test="menucode != null">
                #{menucode,jdbcType=VARCHAR},
            </if>
        </trim>
    </insert>


    <update id="update" parameterType="Map">
        update ss_c_menu
        <set>
            <if test="name != null">
                NAME = #{name,jdbcType=VARCHAR},
            </if>
            <if test="menucode != null">
                MENUCODE = #{menucode,jdbcType=VARCHAR},
            </if>
            <if test="url != null">
                URL = #{url,jdbcType=VARCHAR},
            </if>
            <if test="config != null">
                CONFIG = #{config,jdbcType=VARCHAR},
            </if>
            <if test="style != null">
                STYLE = #{style,jdbcType=VARCHAR},
            </if>
            <if test="icon != null">
                ICON = #{icon,jdbcType=VARCHAR},
            </if>
            <if test="icon2 != null">
                ICON2 = #{icon2,jdbcType=VARCHAR},
            </if>
            <if test="menuconfig != null">
                MENUCONFIG = #{menuconfig,jdbcType=VARCHAR},
            </if>
            <if test="visible != null">
                VISIBLE = #{visible,jdbcType=VARCHAR},
            </if>
            <if test="type != null">
                TYPE = #{type,jdbcType=VARCHAR},
            </if>
            <if test="region != null">
                REGION = #{region,jdbcType=VARCHAR},
            </if>
        </set>
        where ID = #{id,jdbcType=INTEGER}
    </update>

    <delete id="delete" parameterType="Integer">
        delete from ss_c_menu
        where ID = #{id}
    </delete>


    <insert id="addSubMenu" parameterType="Map">
        insert into ss_c_subsystem_menu
        <trim prefix="(" suffix=")" suffixOverrides=",">
            <if test="id != null">
                id,
            </if>
            <if test="mid != null">
                mid,
            </if>
            <if test="sid != null">
                sid,
            </if>
        </trim>
        <trim prefix="values (" suffix=")" suffixOverrides=",">
            <if test="id != null">
                #{id,jdbcType=INTEGER},
            </if>
            <if test="mid != null">
                #{mid,jdbcType=INTEGER},
            </if>
            <if test="sid != null">
                #{sid,jdbcType=INTEGER},
            </if>
        </trim>
    </insert>

    <delete id="delSubMenu" parameterType="Integer">
        delete from ss_c_subsystem_menu
        where mid = #{id}
    </delete>

    <select id="selectMenu" resultType="Map" parameterType="Map">
        select t2.* from ss_f_userauth t1
        left join ss_c_menu t2 on t2.ID = t1.RID
        LEFT JOIN  ss_c_subsystem_menu t3 on t3.mid = t2.ID
        LEFT JOIN subsystem t4 on t4.ID = t3.sid
        where t1.STSTATE = 1 and t2.STSTATE = 1 and t1.RTYPE = 2
        and
        <foreach collection="uids" item="uid" separator="or" open="(" close=")">
            t1.UID = ${uid}
        </foreach>
        and t4.sysCode = #{sysCode}

        UNION

        SELECT t1.* FROM ss_c_menu t1
        LEFT JOIN ss_c_subsystem_menu t2 on t2.mid = t1.ID
        LEFT JOIN subsystem t3 on t3.ID = t2.sid
        where t1.PARENTID = -1 AND t1.STSTATE = 1 and t3.sysCode = #{sysCode}

        ORDER BY STORDER
    </select>
</mapper>
