<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.ruoyi.jianguan.common.dao.SsFUserRoleDAO">
  <resultMap id="BaseResultMap" type="com.ruoyi.common.core.domain.model.SsFUserRole">
    <result column="userid" jdbcType="INTEGER" property="userid" />
    <result column="roleid" jdbcType="INTEGER" property="roleid" />
    <result column="sttime" jdbcType="TIMESTAMP" property="sttime" />
    <result column="ststate" jdbcType="INTEGER" property="ststate" />
    <result column="STORDER" jdbcType="INTEGER" property="storder" />
  </resultMap>

  <select id="getRoleByUserids" resultType="com.ruoyi.jianguan.common.domain.dto.RoleDataDTO">
    SELECT
    sr.role_id AS roleid,
    sr.role_name AS NAME,
    sr.role_key CODE
    FROM
    sys_role sr
    LEFT JOIN sys_user_role sur ON sr.role_id = sur.role_id
    WHERE
    sur.user_id in
    <foreach collection="list" index="index" item="item" open="(" separator="," close=")">
      #{item}
    </foreach>
  </select>
<!--
  <select id="getRoleByUserids" resultType="com.ruoyi.jianguan.common.domain.dto.RoleDataDTO">
    select a.id as roleid, a.name as name, a.code from ss_f_roles a
    LEFT JOIN ss_f_user_role b ON a.id = b.roleid where b.userid in
    <foreach collection="list" index="index" item="item" open="(" separator="," close=")">
      #{item}
    </foreach>
  </select>
-->

  <select id="getRolesIdByUserids" parameterType="java.util.ArrayList" resultType="integer">
    select role_id from sys_user_role where user_id in
    <foreach collection="list" index="index" item="item" open="(" separator="," close=")">
      #{item}
    </foreach>
  </select>
<!--
  <select id="getRolesIdByUserids" parameterType="java.util.ArrayList" resultType="integer">
    select roleid from ss_f_user_role where userid in
    <foreach collection="list" index="index" item="item" open="(" separator="," close=")">
      #{item}
    </foreach>
  </select>
  -->
  <select id="getRolesByGroupIds" resultType="com.ruoyi.jianguan.common.domain.entity.SsFRoles">
    select
    a.role_id as id , a.role_name as name , a.role_key as code , a.parent_id as PARENTID, 1 as type,
    a.role_level as  ROLELEVEL, null as   VISIBLE, a.create_time as  STTIME, a.`status`  as  STSTATE, 0 as STORDER
    from
    sys_role a
    left join sys_user_role b on a.role_id = b.role_id
    left join sys_user su    on b.user_id = su.user_id
    where
    su.dept_id  in
    <foreach collection="list" index="index" item="item" open="(" separator="," close=")">
      #{item}
    </foreach>
        group by a.role_name, a.role_id
  </select>

  <!--
  modify by yangaogao  20230421  修改为ruoyi的系统表
  <select id="getRolesByGroupIds" resultType="com.ruoyi.jianguan.common.domain.entity.SsFRoles">
    select
        a.id, a.NAME, a.CODE, a.PARENTID, a.TYPE,
        a.ROLELEVEL, a.VISIBLE, a.STTIME, a.STSTATE, a.STORDER
    from
        ss_f_roles a
    left join ss_f_user_role b on a.id = b.roleid
    left join ss_f_user_group c on b.userid = c.userid
    where
        c.groupid in
    <foreach collection="list" index="index" item="item" open="(" separator="," close=")">
      #{item}
    </foreach>
        group by a.NAME, a.CODE
  </select>-->

  <select id="findParentCodesByRoleIds">
    select role_key from sys_role where role_id in
    <foreach collection="roleIds" index="index" item="item" open="(" separator="," close=")">
      #{item.parentid}
    </foreach>
  </select>

</mapper>
