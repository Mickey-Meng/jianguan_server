<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.ruoyi.jianguan.common.dao.ProduceandrecodeDAO">
  <resultMap id="BaseResultMap" type="com.ruoyi.common.core.domain.entity.Produceandrecode">
    <id column="id" jdbcType="INTEGER" property="id" />
    <result column="conponentid" jdbcType="INTEGER" property="conponentid" />
    <result column="recodeid" jdbcType="INTEGER" property="recodeid" />
    <result column="produceid" jdbcType="INTEGER" property="produceid" />
    <result column="projectcode" jdbcType="VARCHAR" property="projectcode" />
    <result column="checkresult" jdbcType="INTEGER" property="checkresult" />
    <result column="checkuser" jdbcType="INTEGER" property="checkuser" />
    <result column="updateuser" jdbcType="INTEGER" property="updateuser" />
    <result column="stime" jdbcType="TIMESTAMP" property="stime" />
    <result column="updatetime" jdbcType="TIMESTAMP" property="updatetime" />
    <result column="producename" jdbcType="VARCHAR" property="producename" />
    <result column="conponenttype" jdbcType="VARCHAR" property="conponenttype" />
    <result column="conponentname" jdbcType="VARCHAR" property="conponentname" />
    <result column="updateusername" jdbcType="VARCHAR" property="updateusername" />
    <result column="checkusername" jdbcType="VARCHAR" property="checkusername" />
    <result column="conponentcode" jdbcType="VARCHAR" property="conponentcode" />
    <result column="projectId" jdbcType="INTEGER" property="projectId" />
  </resultMap>
  <resultMap id="conModel" type="com.ruoyi.jianguan.common.domain.dto.ConModel">
    <id column="id" jdbcType="INTEGER" property="id" />
    <result column="conponentcode" jdbcType="VARCHAR" property="conponentcode" />
    <result column="w3" jdbcType="VARCHAR" property="w3" />
    <result column="w2" jdbcType="VARCHAR" property="w2" />
    <result column="w2code" jdbcType="VARCHAR" property="w2code" />
    <result column="conponenttypename" jdbcType="VARCHAR" property="conponenttypename" />
    <result column="conponenttype" jdbcType="VARCHAR" property="conponenttype" />
    <result column="name" jdbcType="VARCHAR" property="name" />
    <result column="recodeid" jdbcType="INTEGER" property="recodeid" />
    <result column="produceid" jdbcType="INTEGER" property="produceid" />
    <result column="plansttime" jdbcType="TIMESTAMP" property="plansttime" />
    <result column="planendtime" jdbcType="TIMESTAMP" property="planendtime" />
    <result column="actulsttime" jdbcType="TIMESTAMP" property="actulsttime" />
    <result column="actulendtime" jdbcType="TIMESTAMP" property="actulendtime" />
    <result column="xxsttime" jdbcType="TIMESTAMP" property="xxsttime" />
    <result column="xxendtime" jdbcType="TIMESTAMP" property="xxendtime" />
  </resultMap>
  <sql id="Base_Column_List">
    id, conponentid, recodeid, produceid, projectcode, checkresult, checkuser, updateuser,
    stime, updatetime, producename, conponenttype, conponentname, updateusername, checkusername,
    conponentcode, projectId
  </sql>

  <select id="selectByPrimaryKey" parameterType="java.lang.Integer" resultMap="BaseResultMap">
    select
    <include refid="Base_Column_List" />
    from produceandrecode
    where id = #{id,jdbcType=INTEGER}
  </select>
  <delete id="deleteByPrimaryKey" parameterType="java.lang.Integer">
    delete from produceandrecode
    where id = #{id,jdbcType=INTEGER}
  </delete>
  <insert id="insert" keyColumn="id" keyProperty="id" parameterType="com.ruoyi.common.core.domain.entity.Produceandrecode" useGeneratedKeys="true">
    insert into produceandrecode (conponentid, recodeid, produceid,
      projectcode, checkresult, checkuser,
      updateuser, stime, updatetime,
      producename, conponenttype, conponentname,
      updateusername, checkusername, conponentcode, status, projectId
      )
    values (#{conponentid,jdbcType=INTEGER}, #{recodeid,jdbcType=INTEGER}, #{produceid,jdbcType=INTEGER},
      #{projectcode,jdbcType=VARCHAR}, #{checkresult,jdbcType=INTEGER}, #{checkuser,jdbcType=INTEGER},
      #{updateuser,jdbcType=INTEGER}, #{stime,jdbcType=TIMESTAMP}, #{updatetime,jdbcType=TIMESTAMP},
      #{producename,jdbcType=VARCHAR}, #{conponenttype,jdbcType=VARCHAR}, #{conponentname,jdbcType=VARCHAR},
      #{updateusername,jdbcType=VARCHAR}, #{checkusername,jdbcType=VARCHAR}, #{conponentcode,jdbcType=VARCHAR},
      #{status,jdbcType=INTEGER}, #{projectId,jdbcType=INTEGER}
      )
  </insert>

  <update id="updateByPrimaryKey" parameterType="com.ruoyi.common.core.domain.entity.Produceandrecode">
    update produceandrecode
    set conponentid = #{conponentid,jdbcType=INTEGER},
      recodeid = #{recodeid,jdbcType=INTEGER},
      produceid = #{produceid,jdbcType=INTEGER},
      projectcode = #{projectcode,jdbcType=VARCHAR},
      checkresult = #{checkresult,jdbcType=INTEGER},
      checkuser = #{checkuser,jdbcType=INTEGER},
      updateuser = #{updateuser,jdbcType=INTEGER},
      stime = #{stime,jdbcType=TIMESTAMP},
      updatetime = #{updatetime,jdbcType=TIMESTAMP},
      producename = #{producename,jdbcType=VARCHAR},
      conponenttype = #{conponenttype,jdbcType=VARCHAR},
      conponentname = #{conponentname,jdbcType=VARCHAR},
      updateusername = #{updateusername,jdbcType=VARCHAR},
      checkusername = #{checkusername,jdbcType=VARCHAR},
      conponentcode = #{conponentcode,jdbcType=VARCHAR}
    where id = #{id,jdbcType=INTEGER}
  </update>



  <select id="getAllProduce" parameterType="com.ruoyi.jianguan.common.domain.dto.RecodeQueryData" resultMap="BaseResultMap">
    select a.* from produceandrecode a
     left join conponent b on a.conponentcode = b.conponentcode
     where a.projectcode in
    <foreach collection="list" index="index" item ="item" open="(" separator="," close=")">
      #{item}
    </foreach>
    <if test="projectType != null">
      and b.projecttype = #{projectType}
    </if>
    <if test="type != null and type != ''">
      and a.conponenttype = #{type}
    </if>
    <if test="code != null and type != ''">
      and a.conponentcode like   concat('%', #{code}, '%')
    </if>
    <if test="sttime != null and type != ''">
      and a.updatetime &gt;= #{sttime}
    </if>
    <if test="endtime != null and type != ''">
      and a.updatetime &lt;= #{endtime}
    </if>
    and a.conponentid is not null
  </select>

  <select id="getAllProduceTime" parameterType="com.ruoyi.jianguan.common.domain.dto.RecodeQueryData" resultMap="BaseResultMap">
    select a.* from produceandrecode a
     left join conponent b on a.conponentcode = b.conponentcode
     where a.projectcode in
    <foreach collection="list" index="index" item ="item" open="(" separator="," close=")">
      #{item}
    </foreach>
    <if test="projectType != null">
        and b.projecttype = #{projectType}
    </if>
    <if test="type != null and type != ''">
      and a.conponenttype = #{type}
    </if>
    <if test="code != null">
      and a.conponentcode like   concat('%', #{code}, '%')
    </if>
    <if test="sttime != null ">
      and a.updatetime &gt;= #{newStime}
    </if>
    <if test="endtime != null ">
      and a.updatetime &lt;= #{newEndTime}
    </if>
    and a.conponentid is not null
  </select>

  <select id="getRecodeId" parameterType="java.util.ArrayList"  resultMap="BaseResultMap">
    select * from produceandrecode where produceid in
    <foreach collection="list" index="index" item ="item" open="(" separator="," close=")">
      #{item}
    </foreach>
  </select>

  <select id="getRecodeModel" parameterType="java.util.ArrayList"  resultMap="conModel">
    select a.id,a.conponentcode,
    a.w3,a.w2,a.w2code,a.conponenttypename,a.conponenttype,a.name,
    b.recodeid ,b.produceid,
    c.plansttime ,c.planendtime ,c.actulsttime ,c.actulendtime ,c.xxsttime ,c.xxendtime from conponent a
    left join produceandrecode b
    on a.id = b.conponentid
    left join zj_conponent_producetime c
    on c.conponentid = a.id
    where a.conponenttype = #{type}
    and a.projectcode in
    <foreach collection="list" index="index" item ="item" open="(" separator="," close=")">
      #{item}
    </foreach>
    order by b.produceid
  </select>



  <select id="getRecodeModelAndConponentId" parameterType="java.util.ArrayList"  resultMap="conModel">
    select a.id,a.conponentcode,a.w7,a.w2,a.w2code,a.w5,a.w5code,a.w6,
    b.recodeid ,b.produceid,
    c.plansttime ,c.planendtime ,c.actulsttime ,c.actulendtime ,c.xxsttime ,c.xxendtime from conponent a
    left join produceandrecode b
    on a.id = b.conponentid
    left join zj_conponent_producetime c
    on c.conponentid = a.id
    where a.conponenttype is not null
    and a.id = #{conponentidadd}
    order by b.produceid
  </select>


  <select id="getAllByConponentId" parameterType="java.lang.Integer"  resultMap="BaseResultMap">
    select * from produceandrecode where conponentid = #{conponentid,jdbcType=INTEGER}
  </select>

  <select id="getAgencyByUserid" resultMap="BaseResultMap">
    select * from produceandrecode where checkresult = 3 and checkuser = #{checkuser}
    <if test="projectId != null">
      and projectId = #{projectId}
    </if>
     and conponentid is not null
  </select>

  <update id="updateRecondStatus">
    update
        produceandrecode
    set
        checkresult = #{result}, status = #{result}, copyUsers = #{copyUsers}
    where  recodeid =#{recondid}
    <if test="produceid != null">
      and produceid = #{produceid}
    </if>
  </update>

  <update id="updateByCode" parameterType="com.ruoyi.common.core.domain.entity.Produceandrecode">
    update produceandrecode
    <set>
      <if test="conponentid != null">
        conponentid = #{conponentid,jdbcType=INTEGER}
      </if>
      <if test="recodeid != null">
        ,recodeid = #{recodeid,jdbcType=INTEGER}
      </if>
      <if test="produceid != null">
        ,produceid = #{produceid,jdbcType=INTEGER}
      </if>
      <if test="projectcode != null">
        ,projectcode = #{projectcode,jdbcType=VARCHAR}
      </if>
      <if test="checkresult != null">
        ,checkresult = #{checkresult,jdbcType=INTEGER}
      </if>
      <if test="checkuser != null">
        ,checkuser = #{checkuser,jdbcType=INTEGER}
      </if>
      <if test="updateuser != null">
        ,updateuser = #{updateuser,jdbcType=INTEGER}
      </if>
      <if test="stime != null">
        ,stime = #{stime,jdbcType=TIMESTAMP}
      </if>
      <if test="updatetime != null">
        ,updatetime = #{updatetime,jdbcType=TIMESTAMP}
      </if>
      <if test="producename != null and producename != ''">
        ,producename = #{producename,jdbcType=VARCHAR}
      </if>
      <if test="conponenttype != null and conponenttype != ''">
        ,conponenttype = #{conponenttype,jdbcType=VARCHAR}
      </if>
      <if test="conponentname != null and conponentname != ''">
        ,conponentname = #{conponentname,jdbcType=VARCHAR}
      </if>
      <if test="updateusername != null and updateusername != ''">
        ,updateusername = #{updateusername,jdbcType=VARCHAR}
      </if>
      <if test="checkusername != null and checkusername != ''">
        ,checkusername = #{checkusername,jdbcType=VARCHAR}
      </if>
      <if test="conponentcode != null and conponentcode != ''">
        ,conponentcode = #{conponentcode,jdbcType=VARCHAR}
      </if>
      <if test="status != null">
        ,status = #{status,jdbcType=INTEGER}
      </if>
      <if test="projectId != null">
        ,projectId = #{projectId,jdbcType=INTEGER}
      </if>
    </set>
    where id = #{id,jdbcType=INTEGER}
  </update>

  <select id="getByProjectcode" parameterType="java.util.ArrayList" resultMap="BaseResultMap">
    select * from produceandrecode where projectcode in
    <foreach collection="list" index="index" item ="item" open="(" separator="," close=")">
      #{item}
    </foreach>
  </select>

  <select id="getConpontentCodeByRecodeId" resultType="string">
    select conponentcode from produceandrecode where recodeid = #{recodeid}
    <if test="produceid != null">
      and produceid = #{produceid}
    </if>
  </select>

  <select id="getCheckuserByRecodeid" resultType="integer">
    select checkuser from produceandrecode where recodeid =#{recondid}
    <if test="produceid != null">
      and produceid = #{produceid}
    </if>
  </select>

  <update id="updateReject">
    update produceandrecode set status = 2, checkresult = 2 where recodeid =#{recodeid}
    <if test="produceid != null">
      and produceid = #{produceid}
    </if>
  </update>

  <select id="getAll" resultMap="BaseResultMap">
    select * from produceandrecode order by updatetime desc;
  </select>

  <select id="selectByRecodeId" resultMap="BaseResultMap">
    select * from produceandrecode where recodeid = #{recodeid}
    <if test="produceid != null">
      and produceid = #{produceid}
    </if>
  </select>

  <select id="getAllByConponentCodes" parameterType="string" resultMap="BaseResultMap">
    select * from produceandrecode where conponentcode in
    <foreach collection="list" index="index" item ="item" open ="(" separator="," close=")">
      #{item}
    </foreach>
  </select>


  <resultMap id="ProduceDTOMap" type="com.ruoyi.jianguan.common.domain.dto.ProduceAndRecodeDTO">
    <id column="id" jdbcType="INTEGER" property="id" />
    <result column="conponentid" jdbcType="INTEGER" property="conponentid" />
    <result column="recodeid" jdbcType="INTEGER" property="recodeid" />
    <result column="produceid" jdbcType="INTEGER" property="produceid" />
    <result column="projectcode" jdbcType="VARCHAR" property="projectcode" />
    <result column="checkresult" jdbcType="INTEGER" property="checkresult" />
    <result column="checkuser" jdbcType="INTEGER" property="checkuser" />
    <result column="updateuser" jdbcType="INTEGER" property="updateuser" />
    <result column="stime" jdbcType="TIMESTAMP" property="stime" />
    <result column="updatetime" jdbcType="TIMESTAMP" property="updatetime" />
    <result column="producename" jdbcType="VARCHAR" property="producename" />
    <result column="conponenttype" jdbcType="VARCHAR" property="conponenttype" />
    <result column="conponentname" jdbcType="VARCHAR" property="conponentname" />
    <result column="updateusername" jdbcType="VARCHAR" property="updateusername" />
    <result column="checkusername" jdbcType="VARCHAR" property="checkusername" />
    <result column="conponentcode" jdbcType="VARCHAR" property="conponentcode" />
  </resultMap>


  <select id="getAllProduceByProjectId" resultMap="ProduceDTOMap">
    select * from produceandrecode where projectId = #{projectId} and checkresult = 1
    order by updatetime desc
  </select>

  <select id="getAllByProjectAndUnitCodes" parameterType="string" resultMap="ProduceDTOMap">
    select * from produceandrecode where projectId = #{projectId} and checkresult = 1
    and projectcode in
    <foreach collection="list" index="index" item ="item" open="(" separator="," close=")">
      #{item}
    </foreach>
    order by updatetime desc
  </select>

  <select id="getAllByUnitAndTime" parameterType="string" resultMap="ProduceDTOMap">
    select * from produceandrecode where projectId = #{projectId} and checkresult = 1
    and projectcode in
    <foreach collection="list" index="index" item ="item" open="(" separator="," close=")">
      #{item}
    </foreach>
    and updatetime &gt;= #{start} and updatetime &lt;= #{end}
    order by updatetime desc
  </select>

  <insert id="insertProduceUser" parameterType="com.ruoyi.jianguan.common.domain.entity.ProduceandrecodeUser">
    insert into produceandrecode_user(gid, userid, ststate, storder)
    values(#{gid,jdbcType=INTEGER}, #{userid,jdbcType=INTEGER},
     #{ststate,jdbcType=INTEGER}, #{storder,jdbcType=INTEGER})
  </insert>

  <select id="getProduceCopyByGids" resultMap="BaseResultMap">
    select <include refid="Base_Column_List" />
    from produceandrecode where id in
    <foreach collection="list" index="index" item ="item" open="(" separator="," close=")">
      #{item}
    </foreach>
  </select>
</mapper>
