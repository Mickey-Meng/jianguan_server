<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.ruoyi.czjg.zjrw.dao.ZjSafeEventDAO">
    <resultMap id="safeCheck" type="com.ruoyi.czjg.zjrw.domain.entity.SafeCheckData">
        <id column="id" jdbcType="INTEGER" property="id"/>
        <result column="checkFirstId" jdbcType="INTEGER" property="checkFirstId"/>
        <result column="checkFirstName" jdbcType="VARCHAR" property="checkFirstName"/>
        <result column="nodo" jdbcType="INTEGER" property="nodo"/>
        <result column="nodelay" jdbcType="INTEGER" property="nodelay"/>
        <result column="nocheck" jdbcType="INTEGER" property="nocheck"/>
        <result column="finish" jdbcType="INTEGER" property="finish"/>
        <result column="countall" jdbcType="INTEGER" property="countall"/>

    </resultMap>
    <resultMap id="BaseResultMap" type="com.ruoyi.czjg.zjrw.domain.entity.ZjSafeEvent">
        <id column="id" jdbcType="INTEGER" property="id"/>
        <result column="safefirst" jdbcType="INTEGER" property="safefirst"/>
        <result column="safesecond" jdbcType="INTEGER" property="safesecond"/>
        <result column="uploadid" jdbcType="INTEGER" property="uploadid"/>
        <result column="uploadname" jdbcType="VARCHAR" property="uploadname"/>
        <result column="uploadurl" jdbcType="VARCHAR" property="uploadurl"/>
        <result column="uploadtime" jdbcType="TIMESTAMP" property="uploadtime"/>
        <result column="uploadloaction" jdbcType="VARCHAR" property="uploadloaction"/>
        <result column="loacltion" jdbcType="VARCHAR" property="loacltion"/>
        <result column="uploadremark" jdbcType="VARCHAR" property="uploadremark"/>
        <result column="modifyid" jdbcType="INTEGER" property="modifyid"/>
        <result column="modifyname" jdbcType="VARCHAR" property="modifyname"/>
        <result column="modifydate" jdbcType="INTEGER" property="modifydate"/>
        <result column="modifytime" jdbcType="TIMESTAMP" property="modifytime"/>
        <result column="modifyremark" jdbcType="VARCHAR" property="modifyremark"/>
        <result column="delayday" jdbcType="INTEGER" property="delayday"/>
        <result column="status" jdbcType="INTEGER" property="status"/>
        <result column="normal" jdbcType="INTEGER" property="normal"/>
        <result column="modifyurl" jdbcType="VARCHAR" property="modifyurl"/>
        <result column="delayreason" jdbcType="VARCHAR" property="delayreason"/>
        <result column="delayresult" jdbcType="INTEGER" property="delayresult"/>
        <result column="dodelayreason" jdbcType="VARCHAR" property="dodelayreason"/>
        <result column="gongquid" jdbcType="INTEGER" property="gongquid"/>
        <result column="safefirstname" jdbcType="VARCHAR" property="safefirstname"/>
        <result column="safesecondname" jdbcType="VARCHAR" property="safesecondname"/>
        <result column="projectId" jdbcType="INTEGER" property="projectId"/>
        <result column="singleProjectId" jdbcType="INTEGER" property="singleProjectId"/>
    </resultMap>


    <resultMap id="abc" type="com.ruoyi.czjg.zjrw.domain.entity.SafeGongQugroup">
        <result column="gongquname" jdbcType="VARCHAR" property="gongquname"/>
        <result column="gongquid" jdbcType="INTEGER" property="gongquid"/>
        <result column="count" jdbcType="INTEGER" property="count"/>
        <result column="finish" jdbcType="INTEGER" property="finish"/>
    </resultMap>

    <resultMap id="abcd" type="com.ruoyi.czjg.zjrw.domain.entity.SafeGongQugroupOverdue">
        <result column="gongquname" jdbcType="VARCHAR" property="gongquname"/>
        <result column="gongquid" jdbcType="INTEGER" property="gongquid"/>
        <result column="overdue" jdbcType="INTEGER" property="overdue"/>
    </resultMap>

    <resultMap id="abd" type="com.ruoyi.czjg.zjrw.domain.dto.EventGroup">
        <result column="gongquname" jdbcType="VARCHAR" property="gongquname"/>
        <result column="gongquid" jdbcType="INTEGER" property="gongquid"/>
        <result column="safefirstname" jdbcType="VARCHAR" property="safefirstname"/>
        <result column="count" jdbcType="INTEGER" property="count"/>
    </resultMap>

    <sql id="Base_Column_List">
    id, safefirst, safesecond, uploadid, uploadname, uploadurl, uploadtime, uploadloaction,
    loacltion, uploadremark, modifyid, modifyname, modifydate, modifytime, modifyremark,
    delayday, `status`, normal, modifyurl, delayreason, delayresult, dodelayreason, gongquid,
    safefirstname, safesecondname, singleProjectId, projectId
  </sql>
    <select id="selectByPrimaryKey" parameterType="java.lang.Integer" resultMap="BaseResultMap">
        select
        <include refid="Base_Column_List"/>
        from zj_safe_event
        where id = #{id,jdbcType=INTEGER}
    </select>
    <delete id="deleteByPrimaryKey" parameterType="java.lang.Integer">
    delete from zj_safe_event
    where id = #{id,jdbcType=INTEGER}
  </delete>
    <insert id="insert" keyColumn="id" keyProperty="id" parameterType="com.ruoyi.czjg.zjrw.domain.entity.ZjSafeEvent"
            useGeneratedKeys="true">
    insert into zj_safe_event (safefirst, safesecond, uploadid,
      uploadname, uploadurl, uploadtime,
      uploadloaction, loacltion, uploadremark,
      modifyid, modifyname, modifydate,
      modifytime, modifyremark, delayday,
      `status`, normal, modifyurl,
      delayreason, delayresult, dodelayreason,
      gongquid, safefirstname, safesecondname,
      singleProjectId, projectId)
    values (#{safefirst,jdbcType=INTEGER}, #{safesecond,jdbcType=INTEGER}, #{uploadid,jdbcType=INTEGER},
      #{uploadname,jdbcType=VARCHAR}, #{uploadurl,jdbcType=VARCHAR}, #{uploadtime,jdbcType=TIMESTAMP},
      #{uploadloaction,jdbcType=VARCHAR}, #{loacltion,jdbcType=VARCHAR}, #{uploadremark,jdbcType=VARCHAR},
      #{modifyid,jdbcType=INTEGER}, #{modifyname,jdbcType=VARCHAR}, #{modifydate,jdbcType=INTEGER},
      #{modifytime,jdbcType=TIMESTAMP}, #{modifyremark,jdbcType=VARCHAR}, #{delayday,jdbcType=INTEGER},
      #{status,jdbcType=INTEGER}, #{normal,jdbcType=INTEGER}, #{modifyurl,jdbcType=VARCHAR},
      #{delayreason,jdbcType=VARCHAR}, #{delayresult,jdbcType=INTEGER}, #{dodelayreason,jdbcType=VARCHAR},
      #{gongquid,jdbcType=INTEGER}, #{safefirstname,jdbcType=VARCHAR}, #{safesecondname,jdbcType=VARCHAR},
      #{singleProjectId,jdbcType=INTEGER}, #{projectId,jdbcType=INTEGER})
  </insert>
    <insert id="insertSelective" keyColumn="id" keyProperty="id" parameterType="com.ruoyi.czjg.zjrw.domain.entity.ZjSafeEvent"
            useGeneratedKeys="true">
        insert into zj_safe_event
        <trim prefix="(" suffix=")" suffixOverrides=",">
            <if test="safefirst != null">
                safefirst,
            </if>
            <if test="safesecond != null">
                safesecond,
            </if>
            <if test="uploadid != null">
                uploadid,
            </if>
            <if test="uploadname != null">
                uploadname,
            </if>
            <if test="uploadurl != null">
                uploadurl,
            </if>
            <if test="uploadtime != null">
                uploadtime,
            </if>
            <if test="uploadloaction != null">
                uploadloaction,
            </if>
            <if test="loacltion != null">
                loacltion,
            </if>
            <if test="uploadremark != null">
                uploadremark,
            </if>
            <if test="modifyid != null">
                modifyid,
            </if>
            <if test="modifyname != null">
                modifyname,
            </if>
            <if test="modifydate != null">
                modifydate,
            </if>
            <if test="modifytime != null">
                modifytime,
            </if>
            <if test="modifyremark != null">
                modifyremark,
            </if>
            <if test="delayday != null">
                delayday,
            </if>
            <if test="status != null">
                `status`,
            </if>
            <if test="normal != null">
                normal,
            </if>
            <if test="modifyurl != null">
                modifyurl,
            </if>
            <if test="delayreason != null">
                delayreason,
            </if>
            <if test="delayresult != null">
                delayresult,
            </if>
            <if test="dodelayreason != null">
                dodelayreason,
            </if>
            <if test="gongquid != null">
                gongquid,
            </if>
            <if test="safefirstname != null">
                safefirstname,
            </if>
            <if test="safesecondname != null">
                safesecondname,
            </if>
            <if test="singleProjectId != null">
                singleProjectId,
            </if>
            <if test="projectId != null">
                projectId,
            </if>
        </trim>
        <trim prefix="values (" suffix=")" suffixOverrides=",">
            <if test="safefirst != null">
                #{safefirst,jdbcType=INTEGER},
            </if>
            <if test="safesecond != null">
                #{safesecond,jdbcType=INTEGER},
            </if>
            <if test="uploadid != null">
                #{uploadid,jdbcType=INTEGER},
            </if>
            <if test="uploadname != null">
                #{uploadname,jdbcType=VARCHAR},
            </if>
            <if test="uploadurl != null">
                #{uploadurl,jdbcType=VARCHAR},
            </if>
            <if test="uploadtime != null">
                #{uploadtime,jdbcType=TIMESTAMP},
            </if>
            <if test="uploadloaction != null">
                #{uploadloaction,jdbcType=VARCHAR},
            </if>
            <if test="loacltion != null">
                #{loacltion,jdbcType=VARCHAR},
            </if>
            <if test="uploadremark != null">
                #{uploadremark,jdbcType=VARCHAR},
            </if>
            <if test="modifyid != null">
                #{modifyid,jdbcType=INTEGER},
            </if>
            <if test="modifyname != null">
                #{modifyname,jdbcType=VARCHAR},
            </if>
            <if test="modifydate != null">
                #{modifydate,jdbcType=INTEGER},
            </if>
            <if test="modifytime != null">
                #{modifytime,jdbcType=TIMESTAMP},
            </if>
            <if test="modifyremark != null">
                #{modifyremark,jdbcType=VARCHAR},
            </if>
            <if test="delayday != null">
                #{delayday,jdbcType=INTEGER},
            </if>
            <if test="status != null">
                #{status,jdbcType=INTEGER},
            </if>
            <if test="normal != null">
                #{normal,jdbcType=INTEGER},
            </if>
            <if test="modifyurl != null">
                #{modifyurl,jdbcType=VARCHAR},
            </if>
            <if test="delayreason != null">
                #{delayreason,jdbcType=VARCHAR},
            </if>
            <if test="delayresult != null">
                #{delayresult,jdbcType=INTEGER},
            </if>
            <if test="dodelayreason != null">
                #{dodelayreason,jdbcType=VARCHAR},
            </if>
            <if test="gongquid != null">
                #{gongquid,jdbcType=INTEGER},
            </if>
            <if test="safefirstname != null">
                #{safefirstname,jdbcType=VARCHAR},
            </if>
            <if test="safesecondname != null">
                #{safesecondname,jdbcType=VARCHAR},
            </if>
            <if test="singleProjectId != null">
                #{singleProjectId,jdbcType=INTEGER},
            </if>
            <if test="projectId != null">
                #{projectId,jdbcType=INTEGER},
            </if>
        </trim>
    </insert>
    <update id="updateByPrimaryKeySelective" parameterType="com.ruoyi.czjg.zjrw.domain.entity.ZjSafeEvent">
        update zj_safe_event
        <set>
            <if test="safefirst != null">
                safefirst = #{safefirst,jdbcType=INTEGER},
            </if>
            <if test="safesecond != null">
                safesecond = #{safesecond,jdbcType=INTEGER},
            </if>
            <if test="uploadid != null">
                uploadid = #{uploadid,jdbcType=INTEGER},
            </if>
            <if test="uploadname != null">
                uploadname = #{uploadname,jdbcType=VARCHAR},
            </if>
            <if test="uploadurl != null">
                uploadurl = #{uploadurl,jdbcType=VARCHAR},
            </if>
            <if test="uploadtime != null">
                uploadtime = #{uploadtime,jdbcType=TIMESTAMP},
            </if>
            <if test="uploadloaction != null">
                uploadloaction = #{uploadloaction,jdbcType=VARCHAR},
            </if>
            <if test="loacltion != null">
                loacltion = #{loacltion,jdbcType=VARCHAR},
            </if>
            <if test="uploadremark != null">
                uploadremark = #{uploadremark,jdbcType=VARCHAR},
            </if>
            <if test="modifyid != null">
                modifyid = #{modifyid,jdbcType=INTEGER},
            </if>
            <if test="modifyname != null">
                modifyname = #{modifyname,jdbcType=VARCHAR},
            </if>
            <if test="modifydate != null">
                modifydate = #{modifydate,jdbcType=INTEGER},
            </if>
            <if test="modifytime != null">
                modifytime = #{modifytime,jdbcType=TIMESTAMP},
            </if>
            <if test="modifyremark != null">
                modifyremark = #{modifyremark,jdbcType=VARCHAR},
            </if>
            <if test="delayday != null">
                delayday = #{delayday,jdbcType=INTEGER},
            </if>
            <if test="status != null">
                `status` = #{status,jdbcType=INTEGER},
            </if>
            <if test="normal != null">
                normal = #{normal,jdbcType=INTEGER},
            </if>
            <if test="modifyurl != null">
                modifyurl = #{modifyurl,jdbcType=VARCHAR},
            </if>
            <if test="delayreason != null">
                delayreason = #{delayreason,jdbcType=VARCHAR},
            </if>
            <if test="delayresult != null">
                delayresult = #{delayresult,jdbcType=INTEGER},
            </if>
            <if test="dodelayreason != null">
                dodelayreason = #{dodelayreason,jdbcType=VARCHAR},
            </if>
            <if test="gongquid != null">
                gongquid = #{gongquid,jdbcType=INTEGER},
            </if>
            <if test="safefirstname != null">
                safefirstname = #{safefirstname,jdbcType=VARCHAR},
            </if>
            <if test="safesecondname != null">
                safesecondname = #{safesecondname,jdbcType=VARCHAR},
            </if>
            <if test="singleProjectId != null">
                singleProjectId = #{singleProjectId,jdbcType=INTEGER},
            </if>
            <if test="projectId != null">
                projectId = #{projectId,jdbcType=INTEGER},
            </if>
        </set>
        where id = #{id,jdbcType=INTEGER}
    </update>
    <update id="updateByPrimaryKey" parameterType="com.ruoyi.czjg.zjrw.domain.entity.ZjSafeEvent">
    update zj_safe_event
    set safefirst = #{safefirst,jdbcType=INTEGER},
      safesecond = #{safesecond,jdbcType=INTEGER},
      uploadid = #{uploadid,jdbcType=INTEGER},
      uploadname = #{uploadname,jdbcType=VARCHAR},
      uploadurl = #{uploadurl,jdbcType=VARCHAR},
      uploadtime = #{uploadtime,jdbcType=TIMESTAMP},
      uploadloaction = #{uploadloaction,jdbcType=VARCHAR},
      loacltion = #{loacltion,jdbcType=VARCHAR},
      uploadremark = #{uploadremark,jdbcType=VARCHAR},
      modifyid = #{modifyid,jdbcType=INTEGER},
      modifyname = #{modifyname,jdbcType=VARCHAR},
      modifydate = #{modifydate,jdbcType=INTEGER},
      modifytime = #{modifytime,jdbcType=TIMESTAMP},
      modifyremark = #{modifyremark,jdbcType=VARCHAR},
      delayday = #{delayday,jdbcType=INTEGER},
      `status` = #{status,jdbcType=INTEGER},
      normal = #{normal,jdbcType=INTEGER},
      modifyurl = #{modifyurl,jdbcType=VARCHAR},
      delayreason = #{delayreason,jdbcType=VARCHAR},
      delayresult = #{delayresult,jdbcType=INTEGER},
      dodelayreason = #{dodelayreason,jdbcType=VARCHAR},
      gongquid = #{gongquid,jdbcType=INTEGER},
      safefirstname = #{safefirstname,jdbcType=VARCHAR},
      safesecondname = #{safesecondname,jdbcType=VARCHAR},
      singleProjectId = #{singleProjectId,jdbcType=INTEGER},
      projectId = #{projectId,jdbcType=INTEGER}
    where id = #{id,jdbcType=INTEGER}
  </update>
    <select id="getDataByProjectIds" parameterType="java.util.ArrayList" resultMap="BaseResultMap">
        select
        *
        from zj_safe_event where gongquid in
        <foreach collection="list" index="index" item="item" open="(" separator="," close=")">
            #{item}
        </foreach>
        <if test="sttime != null ">
            and uploadtime &gt;= #{sttime}
        </if>
        <if test="endtime != null ">
            and uploadtime &lt;= #{endtime}
        </if>
    </select>

    <select id="getGQ" resultMap="BaseResultMap">
    select
    *
    from zj_safe_event where
     uploadtime &gt;= #{sttime}
      and uploadtime &lt;= #{endtime}

  </select>


    <select id="getByGQ" resultMap="BaseResultMap">
    select
    *
    from zj_safe_event where
     uploadtime &gt;= #{sttime}
      and uploadtime &lt;= #{endtime}
      and gongquid = #{gqid}

  </select>

    <select id="getDataByProjectId" parameterType="java.util.ArrayList" resultMap="BaseResultMap">
        select
        *
        from zj_safe_event where gongquid in
        <foreach collection="list" index="index" item="item" open="(" separator="," close=")">
            #{item}
        </foreach>
    </select>

    <select id="getDataById" parameterType="java.util.ArrayList" resultMap="BaseResultMap">
        select
        *
        from zj_safe_event where id in
        <foreach collection="list" index="index" item="item" open="(" separator="," close=")">
            #{item}
        </foreach>
    </select>


    <select id="getSafeCheckData" parameterType="java.util.ArrayList" resultMap="safeCheck">
        select
        safefirst as checkFirstId,
        safefirstname as checkFirstName,
        count(case when status = 0 then 1 end ) as nodo,
        count(case when status = 1 then 1 end ) as nodelay,
        count(case when status = 2 then 1 end ) as nocheck,
        count(case when status = 3 then 1 end ) as finish,
        count(1) as countall
        from zj_safe_event where gongquid in
        <foreach collection="list" index="index" item="item" open="(" separator="," close=")">
            #{item}
        </foreach>
        group by safefirst,safefirstname
    </select>


    <select id="getAllStatusCount" parameterType="java.util.ArrayList" resultMap="abc">
        select count(1) as count, count( case when status = 3 then 1 end ) as finish, gongquid
        from zj_safe_event
        where
        gongquid in
        <foreach collection="list" index="index" item="item" open="(" separator="," close=")">
            #{item}
        </foreach>
        and uploadtime &gt;= #{sttime}
        and uploadtime &lt;= #{endtime}
        group by gongquid
    </select>

    <select id="getOverdueCount" parameterType="java.util.ArrayList" resultMap="abcd">
        SELECT count(1) as overdue,gongquid FROM zj_safe_event
        WHERE
        gongquid IN
        <foreach collection="list" index="index" item="item" open="(" separator="," close=")">
            #{item}
        </foreach>
        AND DATE_ADD(uploadtime, INTERVAL modifydate DAY) &lt; SYSDATE()
        AND STATUS in (0,1,2)
        group by gongquid
    </select>

    <select id="getGongquDatas" resultMap="BaseResultMap">
        select
        *
        from zj_safe_event where gongquid in
        <foreach collection="list" index="index" item="item" open="(" separator="," close=")">
            #{item}
        </foreach>
         and projectId = #{projectId}
    </select>


    <select id="group" parameterType="java.util.ArrayList" resultMap="abd">
        select count(1) as count, gongquid ,safefirstname
        from zj_safe_event where gongquid in
        <foreach collection="list" index="index" item="item" open="(" separator="," close=")">
            #{item}
        </foreach>
        and uploadtime &gt;= #{sttime}
        and uploadtime &lt;= #{endtime}
        group by gongquid ,safefirstname

    </select>

    <select id="getGQByUserId" parameterType="java.util.ArrayList" resultMap="BaseResultMap">
    select * from zj_safe_event
     where modifyid = #{modifyid} and status = 0
  </select>

    <select id="getTodoListByJianLiId" parameterType="java.util.ArrayList" resultMap="BaseResultMap">
    select * from zj_safe_event
    where uploadid = #{uploadid} and status in (1,2)
  </select>

    <select id="getGQByGongQuIds" resultMap="BaseResultMap">
        select * from zj_safe_event
        where gongquid in
        <foreach collection="list" index="index" item="item" open="(" separator="," close=")">
            #{item}
        </foreach>
        and uploadtime &gt;= #{sttime}
        and uploadtime &lt;= #{endtime}
    </select>

    <delete id="batchDeleteById" parameterType="java.util.ArrayList">
        delete from zj_safe_event where id in
        <foreach collection="list" index="index" item="item" open="(" separator="," close=")">
            #{item}
        </foreach>
    </delete>

    <select id="getDelayByJianLiId" resultMap="BaseResultMap">
        select * from zj_safe_event where uploadid = #{uploadid} and status = 1
    </select>

    <select id="getRectificationByJianLiId" resultMap="BaseResultMap">
        select * from zj_safe_event where uploadid = #{uploadid} and status = 2
    </select>
</mapper>
